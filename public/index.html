<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Projeto Doar Sangue</title>

    <!-- leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
      integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
      crossorigin=""></script>
      <script>
        alert('Caso esteja fora da cidade de São Paulo, não serão apresentados locais de doação no momento. Pedimos que não conceda a localização, tendo assim melhor experiência com o sistema.')
      </script>
   

    <style>
      body {
        margin: 0px;
      }
      #mapid {
        width: 100%;
        height: 658px;
        border: none;
      }
     
    </style>
  </head>
  <body>
    <!-- update the version number as needed -->
    <script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.5/firebase.js"></script>
    <script src="https://unpkg.com/geofirestore/dist/geofirestore.js"></script>
    <script src="./firestore.js"></script>
    <div id='mapid'>


        <!-- Questinario Mobile -->
        <div class="questionario_mobile">
          <a href="http://eurecaconsultoria.com/" target="_blank" onclick="close_questionario_mobile()">
          <img src="../Insumos/Ícones/kisspng-computer-icons-form-template-desktop-wallpaper-5b2daf3c77da68.6584092315297206364909 (1).png"></a>
          <div id="balao">
              <p>Nos ajude a avaliar o portal participando de nossa pesquisa de avaliação clicando na imagem a cima</p>
          </div>
      </div>
          <!-- Questinario Desktop -->
    <div class="questionario">
      <div id="botao">
          <h3 onclick="abrir_questionario()">Questionário</h3>
          <img id="close" onclick="close_questionario()" src="../Insumos/Ícones/close-button_icon-icons.com_72803.png"/>
      </div>
      <div id="conteudo">
          <p>Nos ajude a avaliar o portal participando de nossa pesquisa de avaliação clicando no link abaixo</p>
          <a href="http://eurecaconsultoria.com/" target="_blank" onclick="link_questionario()">LINK PARA TESTE</a>
      </div>
    </div>
  
  <!-- Botão de informações -->
  <div class="informacoes">
      <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#modalExemplo">
          Informações
      </button>

      <!-- Modal -->
      <div class="modal fade" id="modalExemplo" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
          aria-hidden="true">
          <div class="modal-dialog" role="document">
              <div class="modal-content">
                  <div class="modal-header">
                      <h5 class="modal-title" id="exampleModalLabel">
                        <img src="../Insumos/Ícones/bolsa_media.png">Informações necessárias
                        
                      </h5>
                      <button type="button" class="close" data-dismiss="modal" aria-label="Fechar">
                          <span aria-hidden="true">&times;</span>
                      </button>
                  </div>
                  <div class="modal-body">
                      AGUARDANDO TEXTO!!
                  </div>

              </div>
          </div>
      </div>
  </div>

    </div>
  </div>
    <script>
    //Variáveis iniciais de ambiente
    let localInicial = L.latLng(-23.565658, -46.651218);
    let raioExibicao = 5; //Km
    let distanciaBusca = raioExibicao*10;
    let check = false //checar tempo de execução
    //Criação do mapa 
    var mymap = L.map('mapid', {zoomControl: false}).setView(localInicial, 15);
    mymap.locate({ setView: true, maxZoom:15 }).on("locationfound", e => {
      //Consulta de locais quando usuário passa sua localização
      localDoacao(e.latlng, distanciaBusca).then(consulta => {
        setTimeout(function() {
          console.log(check)
          if(!check) {
            alert('Houve um erro de carregamento. Por favor atualize a página')
          }
        }, 10000)
        console.log(consulta);
        check = apontaLocais(consulta);
      });
    }).on("locationerror", e => {
      //Consulta de locais quando usuário NÃO passa sua localização
      setTimeout(function() {
          console.log(check)
          if(!check) {
            alert('Houve um erro de carregamento. Por favor atualize a página')
          }
        }, 10000)
      localDoacao(localInicial, distanciaBusca).then(consulta =>{
        console.log(consulta);
        check = apontaLocais(consulta);
      });
    });
    </script>
    <script src="./mapbox.js"></script>
  </body>
</html>
